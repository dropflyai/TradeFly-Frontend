<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community | TradeFly - Social Options Trading</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/community.css">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Authentication -->
    <script src="../js/auth.js"></script>
</head>
<body class="dark-mode">
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="/index.html" class="logo">
                    <span class="logo-icon">‚ö°</span>
                    <span class="logo-text">TradeFly</span>
                </a>
                <div class="nav-tabs">
                    <a href="/pages/signals.html" class="nav-tab">Signals</a>
                    <a href="/pages/community.html" class="nav-tab active">Community</a>
                    <a href="/pages/learn.html" class="nav-tab">Learn</a>
                </div>
            </div>

            <div class="nav-right">
                <button class="btn-icon" id="notifications-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 2C6.686 2 4 4.686 4 8v4.697L2.168 14.53A1 1 0 0 0 3 16h14a1 1 0 0 0 .832-1.47L16 12.697V8c0-3.314-2.686-6-6-6z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <path d="M8 16v1a2 2 0 1 0 4 0v-1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <span class="notification-badge">3</span>
                </button>
                <div class="user-menu">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=user" alt="User" class="user-avatar">
                    <span class="user-name">Trader</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="community-container">
        <!-- Left Sidebar: Rooms -->
        <aside class="sidebar-left">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Strategy Rooms</h3>
                <div class="room-list" id="room-list">
                    <!-- Populated by JS -->
                    <div class="room-skeleton">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">My Watchlist</h3>
                <div class="watchlist-mini" id="watchlist-mini">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="sidebar-section">
                <button class="btn-create-post" id="create-post-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>New Post</span>
                </button>
            </div>
        </aside>

        <!-- Center Feed -->
        <main class="feed-main">
            <!-- Feed Filters -->
            <div class="feed-header">
                <div class="feed-tabs">
                    <button class="feed-tab active" data-filter="all">All Signals</button>
                    <button class="feed-tab" data-filter="scalping">Scalping</button>
                    <button class="feed-tab" data-filter="momentum">Momentum</button>
                    <button class="feed-tab" data-filter="volume_spike">Flow</button>
                </div>

                <div class="feed-controls">
                    <select class="filter-dropdown" id="confidence-filter">
                        <option value="0">All Confidence</option>
                        <option value="0.7">70%+</option>
                        <option value="0.8">80%+</option>
                        <option value="0.9">90%+</option>
                    </select>

                    <select class="filter-dropdown" id="sentiment-filter">
                        <option value="">All Sentiment</option>
                        <option value="bullish_call">Bullish (Calls)</option>
                        <option value="bearish_put">Bearish (Puts)</option>
                    </select>
                </div>
            </div>

            <!-- Feed Posts -->
            <div class="feed-posts" id="feed-posts">
                <!-- Skeleton loaders -->
                <div class="post-skeleton">
                    <div class="skeleton-header">
                        <div class="skeleton-avatar"></div>
                        <div class="skeleton-info">
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line short"></div>
                        </div>
                    </div>
                    <div class="skeleton-content">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>
                <div class="post-skeleton">
                    <div class="skeleton-header">
                        <div class="skeleton-avatar"></div>
                        <div class="skeleton-info">
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line short"></div>
                        </div>
                    </div>
                    <div class="skeleton-content">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>
            </div>

            <!-- Infinite Scroll Loader -->
            <div class="load-more" id="load-more">
                <div class="spinner"></div>
            </div>
        </main>

        <!-- Right Sidebar: Trending & Leaderboard -->
        <aside class="sidebar-right">
            <!-- Trending Contracts -->
            <div class="sidebar-widget">
                <h3 class="widget-title">
                    <span class="title-icon">üî•</span>
                    Trending Contracts
                </h3>
                <div class="trending-list" id="trending-contracts">
                    <!-- Populated by JS -->
                    <div class="skeleton-trending">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard -->
            <div class="sidebar-widget">
                <h3 class="widget-title">
                    <span class="title-icon">üèÜ</span>
                    Top Traders
                </h3>
                <div class="leaderboard-list" id="leaderboard">
                    <!-- Populated by JS -->
                    <div class="skeleton-trending">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>
            </div>

            <!-- Live Market Status -->
            <div class="sidebar-widget market-status">
                <h3 class="widget-title">Market Status</h3>
                <div class="market-info">
                    <div class="market-indicator">
                        <div class="pulse-dot"></div>
                        <span id="market-status-text">Market Closed</span>
                    </div>
                    <div class="market-time" id="market-time">Opens in 14h 32m</div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav">
        <a href="/pages/signals.html" class="mobile-nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
            <span>Signals</span>
        </a>
        <a href="/pages/community.html" class="mobile-nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Community</span>
        </a>
        <button class="mobile-nav-item mobile-post-btn" id="mobile-create-post">
            <div class="fab-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                </svg>
            </div>
        </button>
        <a href="/pages/watchlist.html" class="mobile-nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
            <span>Watchlist</span>
        </a>
        <a href="/pages/settings.html" class="mobile-nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>Settings</span>
        </a>
    </nav>

    <!-- Create Post Modal -->
    <div class="modal" id="create-post-modal">
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Post</h2>
                <button class="modal-close" id="modal-close">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <textarea class="post-textarea" id="post-content" placeholder="Share your options insights with the community..."></textarea>

                <div class="post-options">
                    <input type="text" class="post-input" id="contract-symbol" placeholder="Contract symbol (e.g. AAPL_150C_12/20)">

                    <select class="post-select" id="post-sentiment">
                        <option value="">Select sentiment</option>
                        <option value="bullish_call">Bullish (Call)</option>
                        <option value="bearish_put">Bearish (Put)</option>
                        <option value="neutral">Neutral</option>
                    </select>

                    <select class="post-select" id="post-strategy">
                        <option value="">Select strategy</option>
                        <option value="scalping">Scalping</option>
                        <option value="momentum">Momentum</option>
                        <option value="volume_spike">Flow Trading</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="modal-cancel">Cancel</button>
                <button class="btn-primary" id="submit-post">Post</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/community.js"></script>

    <!-- Require Authentication -->
    <script>
        // Protect this page - require login
        (async () => {
            const isAuthenticated = await TradeFlyAuth.requireAuth();

            if (isAuthenticated) {
                // Update user info in nav
                const user = TradeFlyAuth.currentUser;
                if (user) {
                    const userName = document.querySelector('.user-name');
                    const userAvatar = document.querySelector('.user-avatar');

                    if (userName) {
                        userName.textContent = user.email.split('@')[0];
                    }

                    if (userAvatar) {
                        userAvatar.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.id}`;
                    }
                }
            }
        })();
    </script>
</body>
</html>
